<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test coordonn√©es Google Maps vs ancien syst√®me</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f9f9f9;
        }
        .result {
            font-weight: bold;
            margin: 10px 0;
        }
        .google-maps {
            color: #4285f4;
        }
        .old-system {
            color: #ea4335;
        }
        .coordinates {
            font-family: monospace;
            background: #f0f0f0;
            padding: 5px;
            border-radius: 3px;
            margin: 5px 0;
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #3367d6;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test de v√©rification des coordonn√©es Google Maps</h1>
        <p>Ce test v√©rifie que l'algorithme utilise bien les coordonn√©es r√©cup√©r√©es via l'API Google Maps et non plus l'ancien syst√®me de g√©ocodage.</p>
        
        <div class="test-section">
            <h3>üìä √âtat actuel du syst√®me</h3>
            <div id="system-status" class="status">V√©rification en cours...</div>
        </div>
        
        <div class="test-section">
            <h3>üîç Test de coordonn√©es</h3>
            <button onclick="testCoordinates()">Tester les coordonn√©es</button>
            <div id="coordinates-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üìè Test de calcul de distance</h3>
            <button onclick="testDistanceCalculation()">Tester le calcul de distance</button>
            <div id="distance-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üí∞ Test de calcul de prix</h3>
            <button onclick="testPriceCalculation()">Tester le calcul de prix</button>
            <div id="price-result"></div>
        </div>
        
        <div class="test-section">
            <h3>üìã Logs de d√©bogage</h3>
            <div id="debug-logs"></div>
        </div>
    </div>

    <script>
        // Simulation des coordonn√©es Google Maps
        const googleMapsCoordinates = {
            pickup: {
                address: "Nabeul, Tunisie",
                latitude: 36.4510,
                longitude: 10.7376,
                source: "Google Maps API"
            },
            destination: {
                address: "Tunis, Tunisie", 
                latitude: 36.8064,
                longitude: 10.1815,
                source: "Google Maps API"
            }
        };

        // Simulation des coordonn√©es ancien syst√®me
        const oldSystemCoordinates = {
            pickup: {
                address: "Nabeul",
                latitude: 36.4510,
                longitude: 10.7376,
                source: "Nominatim API"
            },
            destination: {
                address: "Tunis",
                latitude: 36.8064,
                longitude: 10.1815,
                source: "Nominatim API"
            }
        };

        // Fonction de calcul de distance (Haversine)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Rayon de la Terre en kilom√®tres
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c;
            return Math.round(distance * 100) / 100;
        }

        // Fonction de calcul de prix
        function calculatePrice(distanceKm, vehicleType = 'sedan') {
            const basePricePerKm = 1.5;
            const vehicleMultipliers = {
                'sedan': 1.0,
                'pickup': 1.0,
                'van': 1.0,
                'minibus': 2.5,
                'bus': 3.5,
                'limousine': 2.0,
                'truck': 2.0,
                'utility': 1.0
            };
            
            let pricePerKm = basePricePerKm;
            if (distanceKm >= 100 && distanceKm < 250) {
                pricePerKm = basePricePerKm * 0.9; // -10%
            } else if (distanceKm >= 250) {
                pricePerKm = basePricePerKm * 0.8; // -20%
            }
            
            const basePrice = distanceKm * pricePerKm;
            const vehicleMultiplier = vehicleMultipliers[vehicleType] || 1.0;
            const totalPrice = basePrice * vehicleMultiplier;
            
            return Math.round(totalPrice * 100) / 100;
        }

        // V√©rifier l'√©tat du syst√®me
        function checkSystemStatus() {
            const statusDiv = document.getElementById('system-status');
            
            // Simuler la v√©rification des coordonn√©es
            const hasGoogleMapsCoords = googleMapsCoordinates.pickup && googleMapsCoordinates.destination;
            const hasOldSystemCoords = oldSystemCoordinates.pickup && oldSystemCoordinates.destination;
            
            if (hasGoogleMapsCoords) {
                statusDiv.className = 'status success';
                statusDiv.innerHTML = `
                    ‚úÖ <strong>Syst√®me Google Maps actif</strong><br>
                    üìç Coordonn√©es de d√©part : ${googleMapsCoordinates.pickup.latitude}, ${googleMapsCoordinates.pickup.longitude}<br>
                    üìç Coordonn√©es d'arriv√©e : ${googleMapsCoordinates.destination.latitude}, ${googleMapsCoordinates.destination.longitude}<br>
                    üîÑ L'algorithme utilise les coordonn√©es Google Maps
                `;
            } else if (hasOldSystemCoords) {
                statusDiv.className = 'status warning';
                statusDiv.innerHTML = `
                    ‚ö†Ô∏è <strong>Fallback vers l'ancien syst√®me</strong><br>
                    üìç Utilisation de Nominatim API<br>
                    üîÑ L'algorithme utilise l'ancien syst√®me de g√©ocodage
                `;
            } else {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `
                    ‚ùå <strong>Aucune coordonn√©e disponible</strong><br>
                    üìç Veuillez s√©lectionner des adresses
                `;
            }
        }

        // Tester les coordonn√©es
        function testCoordinates() {
            const resultDiv = document.getElementById('coordinates-result');
            
            const googleDistance = calculateDistance(
                googleMapsCoordinates.pickup.latitude,
                googleMapsCoordinates.pickup.longitude,
                googleMapsCoordinates.destination.latitude,
                googleMapsCoordinates.destination.longitude
            );
            
            const oldSystemDistance = calculateDistance(
                oldSystemCoordinates.pickup.latitude,
                oldSystemCoordinates.pickup.longitude,
                oldSystemCoordinates.destination.latitude,
                oldSystemCoordinates.destination.longitude
            );
            
            resultDiv.innerHTML = `
                <div class="result">
                    <h4>üìç Coordonn√©es Google Maps :</h4>
                    <div class="coordinates">
                        D√©part : ${googleMapsCoordinates.pickup.latitude}, ${googleMapsCoordinates.pickup.longitude}<br>
                        Arriv√©e : ${googleMapsCoordinates.destination.latitude}, ${googleMapsCoordinates.destination.longitude}
                    </div>
                    <div class="google-maps">Distance calcul√©e : ${googleDistance} km</div>
                </div>
                
                <div class="result">
                    <h4>üìç Ancien syst√®me (Nominatim) :</h4>
                    <div class="coordinates">
                        D√©part : ${oldSystemCoordinates.pickup.latitude}, ${oldSystemCoordinates.pickup.longitude}<br>
                        Arriv√©e : ${oldSystemCoordinates.destination.latitude}, ${oldSystemCoordinates.destination.longitude}
                    </div>
                    <div class="old-system">Distance calcul√©e : ${oldSystemDistance} km</div>
                </div>
                
                <div class="result">
                    <strong>‚úÖ Les coordonn√©es sont identiques : ${googleDistance === oldSystemDistance ? 'OUI' : 'NON'}</strong>
                </div>
            `;
            
            addDebugLog(`Test coordonn√©es - Google Maps: ${googleDistance}km, Ancien: ${oldSystemDistance}km`);
        }

        // Tester le calcul de distance
        function testDistanceCalculation() {
            const resultDiv = document.getElementById('distance-result');
            
            const distance = calculateDistance(
                googleMapsCoordinates.pickup.latitude,
                googleMapsCoordinates.pickup.longitude,
                googleMapsCoordinates.destination.latitude,
                googleMapsCoordinates.destination.longitude
            );
            
            resultDiv.innerHTML = `
                <div class="result">
                    <h4>üìè Calcul de distance avec coordonn√©es Google Maps :</h4>
                    <div class="coordinates">
                        Nabeul ‚Üí Tunis : ${distance} km
                    </div>
                    <div class="google-maps">‚úÖ Utilisation des coordonn√©es Google Maps</div>
                </div>
            `;
            
            addDebugLog(`Calcul distance - ${distance}km avec coordonn√©es Google Maps`);
        }

        // Tester le calcul de prix
        function testPriceCalculation() {
            const resultDiv = document.getElementById('price-result');
            
            const distance = calculateDistance(
                googleMapsCoordinates.pickup.latitude,
                googleMapsCoordinates.pickup.longitude,
                googleMapsCoordinates.destination.latitude,
                googleMapsCoordinates.destination.longitude
            );
            
            const price = calculatePrice(distance, 'sedan');
            
            resultDiv.innerHTML = `
                <div class="result">
                    <h4>üí∞ Calcul de prix avec coordonn√©es Google Maps :</h4>
                    <div class="coordinates">
                        Distance : ${distance} km<br>
                        Tarif/km : 1.5 TND<br>
                        Type v√©hicule : Berline (√ó1.0)<br>
                        Prix final : ${price} TND
                    </div>
                    <div class="google-maps">‚úÖ Prix calcul√© avec les coordonn√©es Google Maps</div>
                </div>
            `;
            
            addDebugLog(`Calcul prix - ${price}TND pour ${distance}km avec coordonn√©es Google Maps`);
        }

        // Ajouter un log de d√©bogage
        function addDebugLog(message) {
            const logsDiv = document.getElementById('debug-logs');
            const timestamp = new Date().toLocaleTimeString();
            logsDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        }

        // Initialiser les tests
        window.onload = function() {
            checkSystemStatus();
            addDebugLog('Syst√®me de test initialis√©');
        };
    </script>
</body>
</html>
